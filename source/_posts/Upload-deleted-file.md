---
title: Upload deleted file
date: 2017-07-30 10:36:00
tags: Javascript
---

最近在项目中遇到两个个问题，
1. 选择文件的时候做filter，只显示特定的文件类型。
2. 在input type 是file的时候，选择上传文件，然后再在文件系统里面删掉对应文件，接着点击上传。

问题一，通过查API解决，HTML5 File API，通过accept 属性指定扩展名，表示服务器可接受的文件类型。
".jpg,.png,.doc" 通过逗号分隔。

问题二，这个在不同浏览器下面的behavior都不一样。

在Chrome下面会上传失败，因为文件已经删除掉了。那么问题来了，有没办法在上传之前就先做检测判断文件是否存在呢？毕竟这样比catch上次失败的错误要好吧。
查了下，原来浏览器有安全策略，不会暴露完整的文件路径， 会转成"**C:\fakepath\\**"。
后来发现可以通过size属性间接判断，因为删除文件后，file对象的size属性的值变成0了。

在IE下面，input file选择了文件后，文件系统里面删除对应文件并不会把文件真正删除，所以上传还是会成功的。

在Firefox，删除文件后，size属性的值没变，不像chrome那样把size变成0， 所以没法子使用这个属性判断。 目前还未想到有更好的方法处理？ 有待继续研究。。。

